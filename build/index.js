(()=>{var e=wp.media.view.MediaFrame.Select,__=wp.i18n.__;wp.media.view.MediaFrame.Select=e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments);var i=wp.media.controller.State.extend({insert:function(){this.frame.close()}});this.states.add([new i({id:"geminimedia",search:!1,title:__("Gemini Image Generation")})]),this.on("content:render:geminimedia",this.renderGeminiMediaContent,this)},browseRouter:function(e){e.set({upload:{text:wp.media.view.l10n.uploadFilesTitle,priority:20},geminimedia:{text:__("Gemini Image Generation"),priority:30},browse:{text:wp.media.view.l10n.mediaLibraryTitle,priority:40}})},renderGeminiMediaContent:function(){var e=new(wp.media.View.extend({tagName:"div",className:"geminimedia-content",template:wp.template("geminimedia"),active:!1,toolbar:null,frame:null}));this.content.set(e)}}),jQuery(document).ready(function(e){e(document).on("click","#gemini-clear-button",function(){e("#gemini_prompt").val(""),e("#gemini-preview").empty()}),e(document).on("click","#gemini-generate-button",function(){var i=e(this),t=e("#gemini_prompt").val();if(!t)return void alert(__("Please enter a prompt."));const a=e("#gemini-preview");a.empty(),i.prop("disabled",!0),i.text(__("Generating...")),e.post(geminiImgGen.ajaxURL,{action:"gemini_img_generate_image",prompt:t,nonce:geminiImgGen.nonce},function(i){if(!i.success)return void alert(__("Error: ")+i.data.message);const t=e("<span>").text(__("Click on the image to upload")).attr("class","gemini-info-message"),n=e("<button>").attr("id","gemini-image-button").attr("data-title",i.data.title).attr("data-alt",i.data.alt),r=e("<img>").attr("src",i.data.image).attr("alt",i.data.alt||__("Generated Image")).attr("class","gemini-generated-image");n.append(r),a.empty().append(n),a.append(t)}).always(function(){i.prop("disabled",!1),i.text(__("Generate"))})}),e(document).on("click","#gemini-image-button",function(){const i=e(this);var t=e(this).data("title"),a=e(this).data("alt"),n=e(this).find("img").attr("src"),r=e(".gemini-info-message");i.prop("disabled",!0),r.text(__("Inserting image...")),r.addClass("spinner is-active"),e.post(geminiImgGen.ajaxURL,{action:"gemini_img_upload_image",title:t,alt:a,image:n,nonce:geminiImgGen.nonce},function(i){if(!i.success)return void alert(__("Error: ")+i.data.message);const t=e("<div>").addClass("notice notice-success").text(__("Image inserted successfully! Please refresh the page and check the media library."));e("#gemini-preview").empty().append(t)}).fail(function(){alert(__("Failed to insert image."))}).always(function(){i.prop("disabled",!1),r.text(__("Click on the image to upload")),r.removeClass("spinner is-active")})})})})();